<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta content="en-au" http-equiv="Content-Language" />
    <meta content="text/html; charset=utf-8" http-equiv="Content-Type" />
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Blog Feed" />
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Blog Feed" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <title>Using Office 365 Migration Api using C#</title>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" />
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Slabo+13px|Slabo+27px" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/3.0.3/normalize.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous" />
    <link rel="stylesheet" type="text/css" href="/css/style.css" />
    <link rel="shortcut icon" href="/img/favicon.ico" />
</head>
<body>
    <div id="container">

		<div id="side">
    <a href="/" id="myface" title="Profile Picture Kees Schollaart" alt="Profile Picture Kees Schollaart">
        <img src="/img/kees.jpg" alt="Site Name" />
    </a>
    <h1 id="myname">
        <a href="/">Kees Schollaart</a>
    </h1>
    <div id="navigation">
        <ul>
            <li><a href="/about.html"><i class="fa fa-info-circle"></i><br/>About</a></li>
            <li><a href="https://nl.linkedin.com/in/keesschollaart" target="_blank"><i class="fa fa-linkedin-square"></i><br />LinkedIn</a></li>
            <li><a href="https://github.com/keesschollaart81" target="_blank"><i class="fa fa-github-square"></i><br />GitHub</a></li>
            <li><a href="http://www.emailmeform.com/builder/form/6cNG0B3bIfEp232ftoKR2zO7" target="_blank"><i class="fa fa-envelope-square"></i><br />contact</a></li>
        </ul>
    </div>
</div>
        
        <div id="content">
           
                <div id="homebutton">
                    <a href="/"><span class="glyphicon glyphicon-home"></span></a>
                </div> 
				
				<h1>Using Office 365 Migration Api using C#</h1>
<div class="subtitle">10 Mar 2016</div>

<p>This blogpost describes how to use the Office 365 Migration Api using your own C# code.</p>

<p>The Office365 Migration Api enables you to upload lots of documents into SharePoint Online withoud being throttled.
<!--more--></p>

<h2 id="what-is-the-migration-api">What is the Migration Api?</h2>

<p>I assume that you know what the Migration Api is and when to use it.</p>

<p>Steven Pogrebivsky has written an <a href="http://www.cmswire.com/cms/information-management/demystifying-the-new-migration-api-for-sharepoint-029245.php">blogpost</a> on this subject which I recomment to read first.</p>

<p>Also Benjamin Niaulin of Share Gate has written an <a href="http://en.share-gate.com/blog/how-to-use-office-365-migration-api">blogpost</a>, off course promoting their software which can help you with your migration.</p>

<h2 id="the-microsoft-powershell-scripts">The Microsoft PowerShell Scripts</h2>
<p>Microsoft provides some PowerShell cmdlets to help you migrate data using the Migration Api. Using the <a href="https://technet.microsoft.com/library/fp161372.aspx">SharePoint Online Management Shell Windows PowerShell environment</a> you can use <a href="https://technet.microsoft.com/library/mt203955.aspx">a set of Migration Api related operations</a>.</p>

<p>What this cmdlets basically do, is:</p>

<ul>
  <li>
    <p>They create a manifest package containing xml files with references to your files</p>
  </li>
  <li>
    <p>Upload your files to Azure Storage</p>
  </li>
  <li>
    <p>Use <a href="https://msdn.microsoft.com/EN-US/library/office/microsoft.sharepoint.client.site.createmigrationjob.aspx">Site.CreateMigrationJob()</a> to start the MigrationJon</p>
  </li>
  <li>
    <p>Read the reporting-queue to provide current job-status</p>
  </li>
</ul>

<p>This PowerShell scripts are easy to use but do not bring a lot of flexibility. For example:</p>

<ul>
  <li>
    <p>Impossible to migrate custom metadata</p>
  </li>
  <li>
    <p>Can not (or hardly) be automated</p>
  </li>
  <li>
    <p>Only one source or destination (folder)</p>
  </li>
  <li>
    <p>Reporting on running job is very basic</p>
  </li>
</ul>

<h2 id="undocumented-features">Undocumented features</h2>
<p>Some technical parts of this migration process are documented, like <a href="https://msdn.microsoft.com/EN-US/library/office/microsoft.sharepoint.client.site.createmigrationjob.aspx">Site.CreateMigrationJob()</a>.</p>

<p>Other parts are not (well) documented, for example the structure of the manifest-package and the reporting-queue messageformat.</p>

<p>There’s also no example project on how to do advanced migration scenario’s and how to use the Api’s yourself.</p>

<h2 id="migration-using-c">Migration using C#</h2>
<p>All the things the PowerShell scripts do, we can do ourselfs using .NET. I created a <a href="https://github.com/keesschollaart81/MigrationApiDemo">Proof Of Concept C# Console Application</a> doing:</p>

<p>1 Create and upload some test-files to Azure Blob Storage</p>

<p>2 Create a Manifest Package based on this test-files</p>

<p>3 Upload this Manifest Package to Azure Blob Storage</p>

<p>4 Start the Migration Job using CSOM</p>

<p>5 Monitor the Reporting Queue and wait for the job to complete</p>

<p>6 Persist errors from the queue and download the log-files from the Migration Job</p>

<h2 id="how-to-use-this-code">How to use this code</h2>
<p>You first need:</p>

<ul>
  <li>
    <p>A SharePoint Online tenant with credentials having write access to the destination Site/Document Library/Folder</p>
  </li>
  <li>
    <p>An existing Site with an existing Document Library to migrate the files to</p>
  </li>
  <li>
    <p>An acountname and accountkey of at least one Azure Storage account, for one migration job, we need two Blob Containers and one Queue. They can be in the same Storage Account but that is not required.</p>
  </li>
</ul>

<p>After setting this variables in the appsettings-section of the App.config file you’re good to go, just run the application. 
After running this application succesfully, two test-files will be uploaded in the configured SharePoint environment. Log files will be stored in the application folder using log4net’s FileAppender.</p>

<p>This application is just to show  you how to migrate files using .NET with a minimal set of code. <strong>It cannot be used as-is in real world scenario’s</strong>!</p>

<p>When you want to use this code, the first thing to change will be the origin of the files from in-memory-generation to (for example) a folder.</p>

<h2 id="more-information">More information</h2>
<p>Feel free to use this code for own/commercial use. For questions or information, contact me!</p>

<ul>
  <li>
    <p><a href="https://github.com/keesschollaart81/MigrationApiDemo">Migration Api using C#, Example code @ GitHub</a></p>
  </li>
  <li>
    <p><a href="https://technet.microsoft.com/library/mt203955.aspx">SharePoint Online and OneDrive Migration Content Roadmap</a></p>
  </li>
  <li>
    <p><a href="https://channel9.msdn.com/Events/Ignite/2015/BRK3153">Channel9: Migration to SharePoint Online Best Practices and New API Investments</a></p>
  </li>
</ul>



  

    <div id="disqus_thread"></div>
    <script>

        var disqus_developer = 1;

        var disqus_config = function () {
            this.page.url = '/2016/03/10/office365-migration-using-c-sharp.html';
            this.page.identifier = 'Using Office 365 Migration Api using C#';
        };

        (function () { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');

            s.src = '//caseschollaartnet.disqus.com/embed.js';

            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    </script>
 
        </div>
    </div>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" integrity="sha384-0mSbJDEHialfmuBBQP6A4Qrprq5OVfW37PRR3j5ELqxss1yVqOtnepnHVP9aJ7xS" crossorigin="anonymous"></script>
<script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-58834-13', 'auto');
  ga('send', 'pageview');

  $(document).ready(function () {
		
			$.backstretch('/img/migration.jpg');
		
    }); 

</script> 
</body>
</html>